experiment:
  name: deepfm_sharedbottom_cvr_ctr

data:
  processed_dir: data/processed
  metadata_path: data/processed/metadata.json
  batch_size: 512
  num_workers: 6
  prefetch_factor: 6
  pin_memory: true
  persistent_workers: false
  drop_last: false
  debug: false
  seed: 20260127
  neg_keep_prob_train: 0.4
embedding:
  default_embedding_dim: 8
  embedding_dim_overrides: {}
  mode: sum
  sparse_grad: true

model:
  name: deepfm_shared_bottom_ctr_cvr
  backbone:
    use_legacy_pseudo_deepfm: false
    return_logit_parts: true
    per_head_add:
      ctr:
        use_wide: true
        use_fm: true
      cvr:
        use_wide: false
        use_fm: false
      ctcvr:
        use_wide: true
        use_fm: true
  enabled_heads:
  - ctr
  - cvr
  tasks:
  - ctr
  - cvr
  heads:
    default:
      mlp_dims:
      - 128
      dropout: 0.1
      use_bn: false
      activation: relu
    ctr: {}
    cvr: {}
  deep_hidden_dims:
  - 256
  - 128
  deep_dropout: 0.2
  deep_activation: relu
  deep_use_bn: false
  fm_enabled: true
  fm_projection_dim: 16
  out_dim: 128
optim:
  type: dual_sparse_dense
  dense:
    lr: 0.0006
    weight_decay: 1e-5
    betas: [0.9, 0.999]
    eps: 1.0e-8
  sparse:
    enabled: true
    lr: 0.001
    betas: [0.9, 0.999]
    eps: 1.0e-8
    allow_fallback_if_empty: false
loss:
  w_ctr: 1.0
  w_cvr: 1.0
  eps: 1.0e-06
runtime:
  device: cuda
  epochs: 1
  log_every: 5000
  amp: true
  grad_diag_enabled: true
  grad_diag_every: 10000
  max_train_steps: 40000
  max_valid_steps: 20000
  grad_clip_norm: 3.0
  seed: 20260127
  resume_path: null
  auto_eval: true
  auto_eval_split: valid
  auto_eval_save_preds: true
  auto_eval_ckpt: best
  save_last: false
