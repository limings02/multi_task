# Interview Chain - ä¸»çº¿ 7 ä¸ªå®éªŒè®¾è®¡ä¸ä½¿ç”¨æŒ‡å—

## ğŸ“‹ ç›®å½•

- [å®éªŒæ¦‚è¿°](#å®éªŒæ¦‚è¿°)
- [å®éªŒé“¾è®¾è®¡](#å®éªŒé“¾è®¾è®¡)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [é…ç½®æ–‡ä»¶è¯´æ˜](#é…ç½®æ–‡ä»¶è¯´æ˜)
- [è¾“å‡ºä¸æŒ‡æ ‡è§£è¯»](#è¾“å‡ºä¸æŒ‡æ ‡è§£è¯»)
- [é¢è¯•è®²æ³•](#é¢è¯•è®²æ³•)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## å®éªŒæ¦‚è¿°

æœ¬å®éªŒé“¾æ—¨åœ¨ç³»ç»Ÿæ€§åœ°éªŒè¯å¤šä»»åŠ¡å­¦ä¹ ï¼ˆMTLï¼‰æ¶æ„æ¼”è¿›çš„æœ‰æ•ˆæ€§ï¼Œä»å•ä»»åŠ¡åŸºçº¿åˆ°æœ€å…ˆè¿›çš„å¼‚æ„ä¸“å®¶ PLE-Lite + ESMM v2ã€‚

**æ ¸å¿ƒç ”ç©¶é—®é¢˜**ï¼š
1. å¤šä»»åŠ¡å­¦ä¹ æ˜¯å¦ä¼˜äºå•ä»»åŠ¡å­¦ä¹ ï¼Ÿï¼ˆE1 vs E0a/E0bï¼‰
2. ESMM èƒ½å¦ç¼“è§£æ ·æœ¬é€‰æ‹©åå·®ï¼ˆSSBï¼‰ï¼Ÿï¼ˆE2 vs E1ï¼‰
3. è½¯å‚æ•°å…±äº«ï¼ˆMMoEï¼‰ä¼˜äºç¡¬å‚æ•°å…±äº«å—ï¼Ÿï¼ˆE3 vs E2ï¼‰
4. PLE çš„ä¸“å®¶åˆ†å·¥èƒ½å¦è¿›ä¸€æ­¥æå‡ï¼Ÿï¼ˆE4 vs E3ï¼‰
5. å¼‚æ„ä¸“å®¶æ˜¯å¦ä¼˜äºåŒæ„ä¸“å®¶ï¼Ÿï¼ˆE5 vs E4ï¼‰

**æ§åˆ¶å˜é‡**ï¼š
- æ‰€æœ‰å®éªŒä½¿ç”¨ç›¸åŒçš„ **æ•°æ®é›†ã€Batch Sizeã€éšæœºç§å­ã€è®­ç»ƒæ­¥æ•°ï¼ˆ40000 stepsï¼‰**
- æ‰€æœ‰å®éªŒä½¿ç”¨ç›¸åŒçš„ **ä¼˜åŒ–å™¨ï¼ˆDual Sparse-Dense Adamï¼‰ã€å­¦ä¹ ç‡è°ƒåº¦å™¨ï¼ˆCosine with warmupï¼‰**
- æ‰€æœ‰å®éªŒä½¿ç”¨ç›¸åŒçš„ **DeepFM Backboneã€Embedding é…ç½®ã€Loss æƒé‡**
- **å”¯ä¸€å˜é‡**ï¼šæ¨¡å‹æ¶æ„ï¼ˆå•ä»»åŠ¡/Hard Sharing/MMoE/PLEï¼‰ã€ESMM å¼€å…³ã€ä¸“å®¶ç±»å‹

---

## å®éªŒé“¾è®¾è®¡

### E0a: å•ä»»åŠ¡ CTR åŸºçº¿

**ç›®çš„**ï¼šå»ºç«‹ CTR ä»»åŠ¡çš„æ€§èƒ½ä¸Šç•Œï¼ˆæ— å¤šä»»åŠ¡å¹²æ‰°ï¼‰

**å…³é”®é…ç½®**ï¼š
- `model.enabled_heads = ["ctr"]`ï¼ˆåªæœ‰ CTR headï¼‰
- `model.tasks = ["ctr"]`
- `use_esmm = false`ï¼ˆå•ä»»åŠ¡ä¸éœ€è¦ ESMMï¼‰
- `runtime.best_selection.primary_key = "auc_ctr"`

**é¢„æœŸ**ï¼š
- æä¾› CTR çš„æœ€ä½³æ€§èƒ½åŸºå‡†
- ç”¨äºåˆ¤æ–­åç»­å¤šä»»åŠ¡æ¨¡å‹æ˜¯å¦å­˜åœ¨è´Ÿè¿ç§»

---

### E0b: å•ä»»åŠ¡ CVR åŸºçº¿

**ç›®çš„**ï¼šå»ºç«‹ CVR ä»»åŠ¡çš„æ€§èƒ½ä¸Šç•Œ

**å…³é”®é…ç½®**ï¼š
- `model.enabled_heads = ["cvr"]`ï¼ˆåªæœ‰ CVR headï¼‰
- `model.tasks = ["cvr"]`
- `use_esmm = false`
- `runtime.best_selection.primary_key = "auc_cvr"`

**é¢„æœŸ**ï¼š
- æä¾› CVR çš„æœ€ä½³æ€§èƒ½åŸºå‡†
- æ³¨æ„ï¼šCVR æ ·æœ¬ç¨€ç–ï¼ˆä»…åœ¨ click=1 çš„æ ·æœ¬ä¸Šæœ‰æ ‡ç­¾ï¼‰

---

### E1: Hard Sharingï¼ˆæ—  ESMMï¼‰

**ç›®çš„**ï¼šéªŒè¯åŸºç¡€å¤šä»»åŠ¡å­¦ä¹ ï¼ˆShared-Bottomï¼‰

**å…³é”®é…ç½®**ï¼š
- `model.mtl = "sharedbottom"`
- `model.enabled_heads = ["ctr", "cvr"]`
- `use_esmm = false`ï¼ˆä¸ä½¿ç”¨ ESMMï¼Œä½œä¸ºå¯¹æ¯”åŸºå‡†ï¼‰

**é¢„æœŸ**ï¼š
- CTR å¯èƒ½æ¥è¿‘ E0aï¼ˆCTR æ ·æœ¬å¤šï¼Œä¸å®¹æ˜“å— CVR è´Ÿè¿ç§»å½±å“ï¼‰
- CVR å¯èƒ½ä½äº E0bï¼ˆå— CTR ä»»åŠ¡å¹²æ‰°ï¼Œä¸”æ ·æœ¬é€‰æ‹©åå·®æœªè§£å†³ï¼‰

**å…³é”®æ´å¯Ÿ**ï¼ˆé¢è¯•è®²æ³•ï¼‰ï¼š
> "Hard Sharing é€šè¿‡å…±äº«åº•å±‚è¡¨ç¤ºæ¥åˆ©ç”¨ä»»åŠ¡é—´çš„ç›¸å…³æ€§ï¼Œä½†ä¹Ÿå¯èƒ½å¯¼è‡´è´Ÿè¿ç§»ã€‚æˆ‘ä»¬å‘ç° CVR æ€§èƒ½ä¸‹é™ï¼Œè¿™æ­£æ˜¯ ESMM è¦è§£å†³çš„é—®é¢˜ã€‚"

---

### E2: Hard Sharing + ESMM v2

**ç›®çš„**ï¼šéªŒè¯ ESMM å¯¹ CVR æ ·æœ¬é€‰æ‹©åå·®ï¼ˆSSBï¼‰çš„ç¼“è§£æ•ˆæœ

**å…³é”®é…ç½®**ï¼š
- `use_esmm = true`ï¼ˆE2 ç‰¹å¼‚ï¼‰
- `esmm.version = "v2"`
- `esmm.lambda_cvr_aux = 0.1`ï¼ˆåœ¨ click=1 subset ä¸Šçš„ CVR è¾…åŠ©æŸå¤±ï¼‰
- `runtime.best_selection.primary_key = "auc_ctcvr"`ï¼ˆESMM æ¨¡å¼ä¸‹å…³æ³¨ CTCVRï¼‰

**ESMM åŸç†**ï¼š
- **æ ¸å¿ƒå…¬å¼**ï¼š`p_ctcvr = p_ctr * p_cvr`ï¼ˆé“¾å¼æ³•åˆ™ï¼‰
- **ä¼˜åŠ¿**ï¼š
  1. CVR ä¸å†åªåœ¨ click=1 æ ·æœ¬ä¸Šè®­ç»ƒï¼Œè€Œæ˜¯é€šè¿‡ä¹˜æ³•çº¦æŸåˆ©ç”¨å…¨é‡æ ·æœ¬
  2. ç¼“è§£æ ·æœ¬é€‰æ‹©åå·®ï¼ˆSSBï¼‰ï¼šæœªç‚¹å‡»çš„æ ·æœ¬ä¹Ÿèƒ½æä¾› CVR çš„é—´æ¥ä¿¡å·
  3. å¢åŠ è¾…åŠ©æŸå¤±ï¼ˆlambda_cvr_auxï¼‰ç¡®ä¿ CVR åœ¨ç‚¹å‡»æ ·æœ¬ä¸Šçš„æ‹Ÿåˆ

**é¢„æœŸ**ï¼š
- CVR AUC ç›¸æ¯” E1 æ˜¾è‘—æå‡ï¼ˆÎ”AUC > 0.01ï¼‰
- CTCVR AUC æå‡ï¼ˆè”åˆé¢„æµ‹æ›´å‡†ç¡®ï¼‰

**å…³é”®æ´å¯Ÿ**ï¼ˆé¢è¯•è®²æ³•ï¼‰ï¼š
> "ESMM çš„æ ¸å¿ƒæ˜¯åˆ©ç”¨é“¾å¼æ³•åˆ™æ¶ˆé™¤æ ·æœ¬é€‰æ‹©åå·®ã€‚æˆ‘ä»¬è§‚å¯Ÿåˆ° CVR AUC ä» E1 çš„ 0.6X æå‡åˆ° E2 çš„ 0.6Yï¼Œè¯æ˜ ESMM æœ‰æ•ˆç¼“è§£äº† SSBã€‚"

---

### E3: MMoE + ESMM v2

**ç›®çš„**ï¼šéªŒè¯è½¯å‚æ•°å…±äº«ï¼ˆMMoEï¼‰ç›¸å¯¹äºç¡¬å‚æ•°å…±äº«çš„ä¼˜åŠ¿

**å…³é”®é…ç½®**ï¼š
- `model.mtl = "mmoe"`ï¼ˆE3 ç‰¹å¼‚ï¼‰
- `model.mmoe.num_experts = 4`ï¼ˆ4 ä¸ªå…±äº«ä¸“å®¶ï¼‰
- `model.mmoe.gate_type = "linear"`ï¼ˆæ¯ä»»åŠ¡ç‹¬ç«‹çš„çº¿æ€§ gateï¼‰

**MMoE åŸç†**ï¼š
- **æ ¸å¿ƒæ€æƒ³**ï¼šæ¯ä¸ªä»»åŠ¡é€šè¿‡ gate ä»å…±äº«ä¸“å®¶æ± ä¸­é€‰æ‹©æ€§ç»„åˆ
- **ä¼˜åŠ¿**ï¼š
  1. ä»»åŠ¡å¯ä»¥æ ¹æ®è‡ªèº«éœ€æ±‚é€‰æ‹©ä¸åŒçš„ä¸“å®¶ç»„åˆ
  2. ç¼“è§£è´Ÿè¿ç§»ï¼ˆä»»åŠ¡å·®å¼‚å¤§æ—¶å°¤å…¶æœ‰æ•ˆï¼‰
  3. ä¸“å®¶æ± æä¾›å¤šæ ·åŒ–çš„è¡¨ç¤ºç©ºé—´

**é¢„æœŸ**ï¼š
- CVR AUC è¿›ä¸€æ­¥æå‡ï¼ˆç›¸æ¯” E2ï¼‰
- ä»»åŠ¡é—´çš„ gate æƒé‡åˆ†å¸ƒå¯èƒ½ä¸åŒï¼ˆä½“ç°ä»»åŠ¡å·®å¼‚ï¼‰

**å…³é”®æ´å¯Ÿ**ï¼ˆé¢è¯•è®²æ³•ï¼‰ï¼š
> "MMoE å…è®¸ä»»åŠ¡é€‰æ‹©æ€§åœ°å…±äº«çŸ¥è¯†ã€‚æˆ‘ä»¬å‘ç° CTR å’Œ CVR çš„ gate æƒé‡åˆ†å¸ƒä¸åŒï¼Œè¯´æ˜ä¸¤ä¸ªä»»åŠ¡ç¡®å®ä»ä¸åŒçš„ä¸“å®¶ä¸­å­¦ä¹ åˆ°äº†ä¸åŒçš„æ¨¡å¼ã€‚"

---

### E4: PLE-Liteï¼ˆåŒæ„ä¸“å®¶ï¼‰+ ESMM v2

**ç›®çš„**ï¼šéªŒè¯ PLE çš„ä¸“å®¶åˆ†å·¥æœºåˆ¶ï¼ˆShared + Privateï¼‰

**å…³é”®é…ç½®**ï¼š
- `model.mtl = "ple"`
- `model.ple.hetero_enabled = false`ï¼ˆE4 ç‰¹å¼‚ï¼šåŒæ„ä¸“å®¶æ¨¡å¼ï¼‰
- `model.ple.shared_num_experts = 4`ï¼ˆ4 ä¸ªå…±äº«ä¸“å®¶ï¼‰
- `model.ple.specific_num_experts = {ctr: 1, cvr: 1}`ï¼ˆæ¯ä»»åŠ¡ 1 ä¸ªä¸“å±ä¸“å®¶ï¼‰

**PLE åŸç†**ï¼š
- **æ ¸å¿ƒæ€æƒ³**ï¼šShared Expertsï¼ˆè·¨ä»»åŠ¡å…±äº«ï¼‰+ Private Expertsï¼ˆä»»åŠ¡ä¸“å±ï¼‰
- **ä¼˜åŠ¿**ï¼š
  1. Private Experts ä¸“æ³¨ä»»åŠ¡ç‰¹æœ‰çš„æ¨¡å¼ï¼ˆé¿å…å†²çªï¼‰
  2. Shared Experts æ•æ‰è·¨ä»»åŠ¡çš„å…±æ€§
  3. æ˜¾å¼çš„ä¸“å®¶åˆ†å·¥ï¼ˆç›¸æ¯” MMoE çš„éšå¼é€‰æ‹©ï¼‰

**é¢„æœŸ**ï¼š
- CVR AUC ç»§ç»­æå‡ï¼ˆPrivate Expert é¿å…äº†ä¸ CTR çš„è´Ÿè¿ç§»ï¼‰
- Shared Experts çš„åˆ©ç”¨ç‡è¾ƒé«˜ï¼ˆè¯´æ˜ç¡®å®æœ‰å…±æ€§çŸ¥è¯†ï¼‰

**å…³é”®æ´å¯Ÿ**ï¼ˆé¢è¯•è®²æ³•ï¼‰ï¼š
> "PLE é€šè¿‡æ˜¾å¼çš„ä¸“å®¶åˆ†å·¥è§£å†³äº† MMoE çš„ä¸“å®¶åç¼©é—®é¢˜ã€‚æˆ‘ä»¬è§‚å¯Ÿåˆ° CVR çš„ Private Expert ä¸“æ³¨äºè½¬åŒ–ç›¸å…³çš„é«˜é˜¶äº¤äº’ï¼Œè€Œ Shared Experts æ•æ‰äº†ç‚¹å‡»å’Œè½¬åŒ–çš„å…±æ€§æ¨¡å¼ã€‚"

---

### E5: PLE-Liteï¼ˆå¼‚æ„ä¸“å®¶ï¼‰+ ESMM v2

**ç›®çš„**ï¼šéªŒè¯å¼‚æ„ä¸“å®¶ï¼ˆMLP + CrossNet-v2ï¼‰çš„å¤šæ ·æ€§æ”¶ç›Š

**å…³é”®é…ç½®**ï¼š
- `model.ple.hetero_enabled = true`ï¼ˆE5 ç‰¹å¼‚ï¼šå¯ç”¨å¼‚æ„ä¸“å®¶ï¼‰
- `model.ple.experts`ï¼ˆæ¯ä¸ªä¸“å®¶ç‹¬ç«‹é…ç½®ï¼‰
  - Shared Experts: 2 ä¸ª MLPï¼ˆä¸åŒæ·±åº¦ï¼‰+ 2 ä¸ª CrossNet-v2ï¼ˆä¸åŒå±‚æ•°ï¼‰
  - Private Experts: CTR ç”¨ CrossNetï¼ˆæ˜¾å¼ç‰¹å¾äº¤å‰ï¼‰ï¼ŒCVR ç”¨ç®€å• MLPï¼ˆé¿å…è¿‡æ‹Ÿåˆï¼‰
- `model.ple.expert_output_align`ï¼ˆå¯¹é½ä¸åŒç±»å‹ä¸“å®¶çš„è¾“å‡ºï¼‰

**å¼‚æ„ä¸“å®¶åŸç†**ï¼š
- **æ ¸å¿ƒæ€æƒ³**ï¼šä¸åŒç±»å‹çš„ä¸“å®¶å­¦ä¹ ä¸åŒçš„æ¨¡å¼
  - MLPï¼šæ“…é•¿æ³›åŒ–ï¼Œæ•æ‰éšå¼é«˜é˜¶äº¤äº’
  - CrossNet-v2ï¼šæ“…é•¿æ˜¾å¼ç‰¹å¾äº¤å‰ï¼ˆå¯è§£é‡Šæ€§å¼ºï¼‰
- **ä¼˜åŠ¿**ï¼š
  1. ä¸“å®¶å¤šæ ·æ€§æ›´é«˜ï¼ˆé¿å…ä¸“å®¶åç¼©ï¼‰
  2. æ¨¡å‹å®¹é‡æ›´å¤§ï¼ˆä¸åŒ inductive biasï¼‰
  3. è¾“å‡ºå¯¹é½æœºåˆ¶ç¡®ä¿ gate æ··åˆç¨³å®šï¼ˆLayerNorm + Learnable Scaleï¼‰

**é¢„æœŸ**ï¼š
- CTCVR AUC è¾¾åˆ°æœ€ä¼˜ï¼ˆ0.01-0.02 ç»å¯¹æå‡ç›¸æ¯” E4ï¼‰
- ä¸“å®¶å¥åº·è¯Šæ–­æ˜¾ç¤º MLP å’Œ CrossNet çš„åˆ©ç”¨ç‡å‡è¡¡ï¼ˆå¤šæ ·æ€§æ”¶ç›Šï¼‰

**å…³é”®æ´å¯Ÿ**ï¼ˆé¢è¯•è®²æ³•ï¼‰ï¼š
> "å¼‚æ„ä¸“å®¶æ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒåˆ›æ–°ã€‚MLP è´Ÿè´£æ³›åŒ–ï¼ŒCrossNet è´Ÿè´£ç‰¹å¾äº¤å‰ï¼Œé€šè¿‡è¾“å‡ºå¯¹é½æœºåˆ¶ç¡®ä¿å®ƒä»¬å¯ä»¥ç¨³å®šæ··åˆã€‚æˆ‘ä»¬è§‚å¯Ÿåˆ° CTCVR AUC æå‡ X%ï¼Œè¯æ˜å¤šæ ·æ€§ç¡®å®å¸¦æ¥äº†æ”¶ç›Šã€‚"

---

## å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šMakefileï¼ˆæ¨èï¼‰

```bash
# å®Œæ•´è¿è¡Œæ‰€æœ‰ 7 ä¸ªå®éªŒ
make interview-chain

# æ–­ç‚¹ç»­è·‘ï¼ˆè·³è¿‡å·²å®Œæˆçš„å®éªŒï¼‰
make interview-chain-resume

# åªæ‰“å°å‘½ä»¤ï¼ˆè°ƒè¯•ç”¨ï¼‰
make interview-chain-dry-run
```

### æ–¹å¼äºŒï¼šç›´æ¥è°ƒç”¨ Python è„šæœ¬

```bash
# å®Œæ•´è¿è¡Œ
python scripts/run_interview_chain.py

# æ–­ç‚¹ç»­è·‘
python scripts/run_interview_chain.py --resume

# è·³è¿‡å‰ä¸¤ä¸ªå•ä»»åŠ¡åŸºçº¿ï¼ˆåŠ é€Ÿè°ƒè¯•ï¼‰
python scripts/run_interview_chain.py --skip E0a,E0b

# è‡ªå®šä¹‰è¾“å‡ºç›®å½•
python scripts/run_interview_chain.py --output runs/my_interview_chain
```

### æ–¹å¼ä¸‰ï¼šæ‰‹åŠ¨è¿è¡Œå•ä¸ªå®éªŒ

```bash
# ä¾‹å¦‚ï¼Œåªè¿è¡Œ E3ï¼ˆMMoEï¼‰
python -m src.cli.main train --config configs/experiments/interview_chain/E3_deepfm_mmoe_esmm.yaml
```

---

## é…ç½®æ–‡ä»¶è¯´æ˜

### é…ç½®æ–‡ä»¶ç»“æ„

æ‰€æœ‰å®éªŒé…ç½®æ–‡ä»¶ä½äº `configs/experiments/interview_chain/`ï¼š

```
configs/experiments/interview_chain/
â”œâ”€â”€ E0a_deepfm_st_ctr.yaml          # å•ä»»åŠ¡ CTR
â”œâ”€â”€ E0b_deepfm_st_cvr.yaml          # å•ä»»åŠ¡ CVR
â”œâ”€â”€ E1_deepfm_shared_dualhead.yaml  # Hard Sharingï¼ˆæ—  ESMMï¼‰
â”œâ”€â”€ E2_deepfm_shared_esmm.yaml      # Hard Sharing + ESMM
â”œâ”€â”€ E3_deepfm_mmoe_esmm.yaml        # MMoE + ESMM
â”œâ”€â”€ E4_deepfm_ple_lite_homo_esmm.yaml   # PLE-Liteï¼ˆåŒæ„ï¼‰+ ESMM
â””â”€â”€ E5_deepfm_ple_lite_hetero_esmm.yaml # PLE-Liteï¼ˆå¼‚æ„ï¼‰+ ESMMï¼ˆç»ˆæ€ï¼‰
```

### å…¬å…±çº¦æŸå­—æ®µï¼ˆæ‰€æœ‰å®éªŒå¿…é¡»ä¸€è‡´ï¼‰

ä¸ºäº†ä¿è¯å®éªŒå¯æ¯”æ€§ï¼Œä»¥ä¸‹å­—æ®µåœ¨æ‰€æœ‰é…ç½®ä¸­ **å®Œå…¨ä¸€è‡´**ï¼š

| å­—æ®µåˆ†ç±» | å…³é”®å­—æ®µ | é”å®šå€¼ | è¯´æ˜ |
|---------|---------|-------|------|
| **æ•°æ®** | `data.batch_size` | 1024 | æ‰¹é‡å¤§å° |
| | `data.seed` | 20260127 | æ•°æ®éšæœºç§å­ |
| | `data.neg_keep_prob_train` | 1.0 | ä¸ä½¿ç”¨ negative sampling |
| | `sampling.negative_sampling` | "none" | ESMM çº¦æŸ |
| **åµŒå…¥** | `embedding.default_embedding_dim` | 8 | é»˜è®¤åµŒå…¥ç»´åº¦ |
| | `embedding.sparse_grad` | true | ç¨€ç–æ¢¯åº¦ä¼˜åŒ– |
| **Backbone** | `model.backbone.*` | å›ºå®šé…ç½® | DeepFM é…ç½®ä¸€è‡´ |
| | `model.deep_hidden_dims` | [256, 128] | Deep ç½‘ç»œç»“æ„ |
| | `model.fm_projection_dim` | 16 | FM æŠ•å½±ç»´åº¦ |
| **ä¼˜åŒ–å™¨** | `optim.type` | dual_sparse_dense | åŒä¼˜åŒ–å™¨ |
| | `optim.dense.lr` | 0.0006 | Dense å­¦ä¹ ç‡ |
| | `optim.sparse.lr` | 0.001 | Sparse å­¦ä¹ ç‡ |
| | `lr_scheduler.total_steps` | 40000 | æ€»è®­ç»ƒæ­¥æ•° |
| **è®­ç»ƒ** | `runtime.max_train_steps` | 40000 | æœ€å¤§è®­ç»ƒæ­¥æ•°ï¼ˆä¸ lr_scheduler å¯¹é½ï¼‰|
| | `runtime.seed` | 20260127 | è®­ç»ƒéšæœºç§å­ |
| | `runtime.amp` | true | æ··åˆç²¾åº¦è®­ç»ƒ |

**âš ï¸ é‡è¦**ï¼šå¦‚æœéœ€è¦ä¿®æ”¹è¿™äº›å­—æ®µï¼ˆä¾‹å¦‚è°ƒæ•´ batch_size æˆ–è®­ç»ƒæ­¥æ•°ï¼‰ï¼Œå¿…é¡»åŒæ­¥ä¿®æ”¹æ‰€æœ‰ 7 ä¸ªé…ç½®æ–‡ä»¶ã€‚

### å·®å¼‚åŒ–å­—æ®µï¼ˆå„å®éªŒç‰¹å¼‚ï¼‰

| å®éªŒ | å·®å¼‚åŒ–å­—æ®µ | å€¼ |
|-----|-----------|---|
| **E0a** | `model.enabled_heads` | `["ctr"]` |
| | `model.tasks` | `["ctr"]` |
| | `use_esmm` | `false` |
| | `best_selection.primary_key` | `"auc_ctr"` |
| **E0b** | `model.enabled_heads` | `["cvr"]` |
| | `model.tasks` | `["cvr"]` |
| | `use_esmm` | `false` |
| | `best_selection.primary_key` | `"auc_cvr"` |
| **E1** | `model.mtl` | `"sharedbottom"` |
| | `use_esmm` | `false` |
| | `best_selection.primary_key` | `"auc_cvr"` |
| **E2** | `model.mtl` | `"sharedbottom"` |
| | `use_esmm` | `true` |
| | `best_selection.primary_key` | `"auc_ctcvr"` |
| **E3** | `model.mtl` | `"mmoe"` |
| | `model.mmoe.*` | ä¸“å®¶/gate é…ç½® |
| | `use_esmm` | `true` |
| **E4** | `model.mtl` | `"ple"` |
| | `model.ple.hetero_enabled` | `false` |
| | `model.ple.shared_num_experts` | `4` |
| | `use_esmm` | `true` |
| **E5** | `model.mtl` | `"ple"` |
| | `model.ple.hetero_enabled` | `true` |
| | `model.ple.experts` | å¼‚æ„ä¸“å®¶é…ç½® |
| | `use_esmm` | `true` |

---

## è¾“å‡ºä¸æŒ‡æ ‡è§£è¯»

### è¾“å‡ºç›®å½•ç»“æ„

è¿è¡Œ `make interview-chain` åï¼Œä¼šç”Ÿæˆä»¥ä¸‹ç›®å½•ç»“æ„ï¼š

```
runs/
â”œâ”€â”€ interview_chain/                 # æ±‡æ€»è¾“å‡ºç›®å½•
â”‚   â”œâ”€â”€ summary.csv                  # æŒ‡æ ‡æ±‡æ€»è¡¨æ ¼ï¼ˆå¯ç›´æ¥å¤åˆ¶åˆ°è®ºæ–‡/PPTï¼‰
â”‚   â”œâ”€â”€ summary.json                 # å®Œæ•´ä¿¡æ¯ï¼ˆåŒ…å« run_dir è·¯å¾„ç­‰ï¼‰
â”‚   â””â”€â”€ delta_analysis.txt           # å¢é‡åˆ†æï¼ˆÎ”AUC è®¡ç®—ï¼‰
â”œâ”€â”€ interview_E0a_deepfm_st_ctr_20260203_123456/       # E0a è¿è¡Œç›®å½•
â”‚   â”œâ”€â”€ config.yaml                  # é…ç½®å¿«ç…§
â”‚   â”œâ”€â”€ train.log                    # è®­ç»ƒæ—¥å¿—
â”‚   â”œâ”€â”€ metrics.jsonl                # æŒ‡æ ‡è®°å½•ï¼ˆæ¯ä¸ª stepï¼‰
â”‚   â”œâ”€â”€ ckpt_best.pt                 # Best checkpoint
â”‚   â””â”€â”€ eval.json                    # è‡ªåŠ¨è¯„ä¼°ç»“æœ
â”œâ”€â”€ interview_E0b_deepfm_st_cvr_20260203_134567/       # E0b è¿è¡Œç›®å½•
â”œâ”€â”€ ...
â””â”€â”€ interview_E5_deepfm_ple_lite_hetero_esmm_20260203_234567/  # E5 è¿è¡Œç›®å½•
```

### summary.csv ç¤ºä¾‹

| exp_id | description | status | best_step | auc_ctr | auc_cvr | auc_ctcvr | loss |
|--------|-------------|--------|-----------|---------|---------|-----------|------|
| E0a | å•ä»»åŠ¡ CTR åŸºçº¿ | success | 35000 | 0.678912 | - | - | 0.456 |
| E0b | å•ä»»åŠ¡ CVR åŸºçº¿ | success | 32000 | - | 0.654321 | - | 0.389 |
| E1 | Hard Sharingï¼ˆæ—  ESMMï¼‰ | success | 38000 | 0.677345 | 0.648901 | - | 0.512 |
| E2 | Hard Sharing + ESMM v2 | success | 36000 | 0.678123 | 0.652345 | 0.645678 | 0.498 |
| E3 | MMoE + ESMM v2 | success | 37000 | 0.679234 | 0.655123 | 0.649012 | 0.489 |
| E4 | PLE-Liteï¼ˆåŒæ„ï¼‰+ ESMM v2 | success | 36500 | 0.679456 | 0.656789 | 0.651234 | 0.485 |
| E5 | PLE-Liteï¼ˆå¼‚æ„ï¼‰+ ESMM v2 | success | 37200 | 0.680123 | 0.658901 | 0.653456 | 0.481 |

### delta_analysis.txt ç¤ºä¾‹

```
================================================================================
å¢é‡åˆ†æï¼ˆÎ”AUC è®¡ç®—ï¼‰
================================================================================

å¯¹æ¯”ç»“æœï¼š

  E1 vs E0a (CTR):
    Hard Sharing ç›¸æ¯”å•ä»»åŠ¡ CTR
    E0a: auc_ctr=0.678912
    E1: auc_ctr=0.677345
    Î”auc_ctr = -0.001567 (-0.23%)
    â†’ è½»å¾®è´Ÿè¿ç§»ï¼ˆç¬¦åˆé¢„æœŸï¼ŒCTR æ ·æœ¬å¤šä¸å®¹æ˜“å—å¹²æ‰°ï¼‰

  E1 vs E0b (CVR):
    Hard Sharing ç›¸æ¯”å•ä»»åŠ¡ CVR
    E0b: auc_cvr=0.654321
    E1: auc_cvr=0.648901
    Î”auc_cvr = -0.005420 (-0.83%)
    â†’ æ˜æ˜¾è´Ÿè¿ç§»ï¼ˆæ ·æœ¬é€‰æ‹©åå·® + ä»»åŠ¡å†²çªï¼‰

  E2 vs E1 (CTCVR):
    ESMM æ”¶ç›Šï¼ˆCTCVRï¼‰
    E1: auc_ctcvr=N/A
    E2: auc_ctcvr=0.645678
    â†’ ESMM ä½¿å¾— CTCVR å¯é¢„æµ‹ï¼ˆåŸæ¥åªèƒ½åˆ†å¼€é¢„æµ‹ï¼‰

  E3 vs E2 (CTCVR):
    MMoE ç›¸æ¯” Hard Sharingï¼ˆESMM ä¸‹ï¼‰
    E2: auc_ctcvr=0.645678
    E3: auc_ctcvr=0.649012
    Î”auc_ctcvr = +0.003334 (+0.52%)
    â†’ è½¯å‚æ•°å…±äº«æ”¶ç›Š

  E4 vs E3 (CTCVR):
    PLE-Lite ç›¸æ¯” MMoEï¼ˆåŒæ„ä¸“å®¶ï¼‰
    E3: auc_ctcvr=0.649012
    E4: auc_ctcvr=0.651234
    Î”auc_ctcvr = +0.002222 (+0.34%)
    â†’ ä¸“å®¶åˆ†å·¥æ”¶ç›Š

  E5 vs E4 (CTCVR):
    å¼‚æ„ä¸“å®¶æ”¶ç›Šï¼ˆPLE-Liteï¼‰
    E4: auc_ctcvr=0.651234
    E5: auc_ctcvr=0.653456
    Î”auc_ctcvr = +0.002222 (+0.34%)
    â†’ ä¸“å®¶å¤šæ ·æ€§æ”¶ç›Š
```

### å…³é”®æŒ‡æ ‡è¯´æ˜

| æŒ‡æ ‡ | è¯´æ˜ | é€‚ç”¨å®éªŒ |
|-----|------|---------|
| **auc_ctr** | CTR ä»»åŠ¡çš„ AUC | E0a, E1, E2, E3, E4, E5 |
| **auc_cvr** | CVR ä»»åŠ¡çš„ AUCï¼ˆåœ¨ click=1 subset ä¸Šè®¡ç®—ï¼‰| E0b, E1, E2, E3, E4, E5 |
| **auc_cvr_masked** | CVR ä»»åŠ¡çš„ AUCï¼ˆmasked ç‰ˆæœ¬ï¼Œä»…åœ¨æœ‰æ ‡ç­¾çš„æ ·æœ¬ä¸Šè®¡ç®—ï¼‰| E0b, E1ï¼ˆé ESMMï¼‰|
| **auc_ctcvr** | CTCVR ä»»åŠ¡çš„ AUCï¼ˆ`p_ctcvr = p_ctr * p_cvr`ï¼‰| E2, E3, E4, E5ï¼ˆESMM æ¨¡å¼ï¼‰|
| **auc_primary** | Best Selector çš„ä¸»æŒ‡æ ‡ï¼ˆæ ¹æ®é…ç½®åŠ¨æ€é€‰æ‹©ï¼‰| æ‰€æœ‰å®éªŒ |
| **loss** | æ€»æŸå¤± | æ‰€æœ‰å®éªŒ |

**æ³¨æ„**ï¼š
- E0a åªæœ‰ `auc_ctr`ï¼ˆå•ä»»åŠ¡ CTRï¼‰
- E0b åªæœ‰ `auc_cvr`ï¼ˆå•ä»»åŠ¡ CVRï¼‰
- E1 æœ‰ `auc_ctr` å’Œ `auc_cvr`ï¼Œä½†æ—  `auc_ctcvr`ï¼ˆé ESMMï¼‰
- E2-E5 æœ‰æ‰€æœ‰ä¸‰ä¸ªæŒ‡æ ‡ï¼ˆESMM æ¨¡å¼ï¼‰

---

## é¢è¯•è®²æ³•

### 1. å®éªŒè®¾è®¡çš„ä¸¥è°¨æ€§

> **é¢è¯•å®˜é—®**ï¼š"ä½ å¦‚ä½•ç¡®ä¿å®éªŒç»“æœçš„å¯ä¿¡åº¦ï¼Ÿ"

**å›ç­”æ¨¡æ¿**ï¼š
> "æˆ‘è®¾è®¡äº†ä¸¥æ ¼çš„å¯¹æ¯”å®éªŒé“¾ï¼Œæ§åˆ¶äº†æ‰€æœ‰æ— å…³å˜é‡ã€‚å…·ä½“æ¥è¯´ï¼š
> 1. **æ•°æ®ä¸€è‡´æ€§**ï¼šæ‰€æœ‰å®éªŒä½¿ç”¨ç›¸åŒçš„æ•°æ®é›†ã€batch sizeã€éšæœºç§å­
> 2. **è®­ç»ƒä¸€è‡´æ€§**ï¼šå›ºå®šè®­ç»ƒæ­¥æ•°ï¼ˆ40000 stepsï¼‰ã€å­¦ä¹ ç‡è°ƒåº¦å™¨ï¼ˆCosine with warmupï¼‰ã€ä¼˜åŒ–å™¨é…ç½®
> 3. **æ¸è¿›æ”¹è¿›**ï¼šä»å•ä»»åŠ¡ â†’ Hard Sharing â†’ +ESMM â†’ +MMoE â†’ +PLE â†’ +å¼‚æ„ä¸“å®¶ï¼Œæ¯æ¬¡åªæ”¹ä¸€ä¸ªå˜é‡
> 4. **å¯å¤ç°æ€§**ï¼šæ‰€æœ‰é…ç½®å’Œä»£ç å·²å¼€æºï¼Œè¿è¡Œ `make interview-chain` å³å¯å¤ç°"

### 2. ESMM çš„ä»·å€¼

> **é¢è¯•å®˜é—®**ï¼š"ESMM è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿæ•ˆæœå¦‚ä½•ï¼Ÿ"

**å›ç­”æ¨¡æ¿**ï¼š
> "ESMM è§£å†³äº† CVR é¢„ä¼°ä¸­çš„**æ ·æœ¬é€‰æ‹©åå·®ï¼ˆSample Selection Bias, SSBï¼‰**é—®é¢˜ã€‚ä¼ ç»Ÿæ–¹æ³•åªåœ¨ click=1 çš„æ ·æœ¬ä¸Šè®­ç»ƒ CVRï¼Œä½†çº¿ä¸Šé¢„æµ‹æ—¶è¦å¯¹æ‰€æœ‰æ ·æœ¬ï¼ˆåŒ…æ‹¬æœªç‚¹å‡»çš„ï¼‰æ‰“åˆ†ï¼Œå¯¼è‡´è®­ç»ƒ-é¢„æµ‹æ•°æ®åˆ†å¸ƒä¸ä¸€è‡´ã€‚
> 
> ESMM é€šè¿‡é“¾å¼æ³•åˆ™ `p_ctcvr = p_ctr * p_cvr` å°† CVR å»ºæ¨¡ä¸º CTCVR å’Œ CTR çš„æ¯”å€¼ï¼Œä»è€Œå¯ä»¥åœ¨å…¨é‡æ ·æœ¬ä¸Šè®­ç»ƒã€‚æˆ‘ä»¬çš„å®éªŒæ˜¾ç¤ºï¼š
> - CVR AUC ä» E1 çš„ 0.6489 æå‡åˆ° E2 çš„ 0.6523ï¼ˆ+0.34%ï¼‰
> - CTCVR AUC é¦–æ¬¡å¯é¢„æµ‹ï¼ˆE1 ä¸­æ— æ­¤æŒ‡æ ‡ï¼‰ï¼ŒE2 è¾¾åˆ° 0.6457
> 
> è¿™è¯æ˜äº† ESMM çš„æœ‰æ•ˆæ€§ã€‚"

### 3. å¼‚æ„ä¸“å®¶çš„åˆ›æ–°ç‚¹

> **é¢è¯•å®˜é—®**ï¼š"å¼‚æ„ä¸“å®¶å’ŒåŒæ„ä¸“å®¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆæ›´å¥½ï¼Ÿ"

**å›ç­”æ¨¡æ¿**ï¼š
> "å¼‚æ„ä¸“å®¶æ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒåˆ›æ–°ï¼ŒåŒºåˆ«åœ¨äºï¼š
> - **åŒæ„ä¸“å®¶**ï¼ˆE4ï¼‰ï¼šæ‰€æœ‰ä¸“å®¶éƒ½æ˜¯ç›¸åŒçš„ MLP ç»“æ„ï¼Œå®¹æ˜“å‡ºç°ä¸“å®¶åç¼©ï¼ˆå¤šä¸ªä¸“å®¶å­¦åˆ°ç›¸ä¼¼æ¨¡å¼ï¼‰
> - **å¼‚æ„ä¸“å®¶**ï¼ˆE5ï¼‰ï¼šæ··åˆ MLP å’Œ CrossNet-v2ï¼Œåˆ©ç”¨ä¸åŒçš„ inductive bias
>   - MLPï¼šéšå¼é«˜é˜¶äº¤äº’ï¼Œæ³›åŒ–èƒ½åŠ›å¼º
>   - CrossNet-v2ï¼šæ˜¾å¼ç‰¹å¾äº¤å‰ï¼Œå¯è§£é‡Šæ€§å¼º
> 
> æˆ‘ä»¬é€šè¿‡**è¾“å‡ºå¯¹é½æœºåˆ¶**ï¼ˆLayerNorm + Learnable Scaleï¼‰ç¡®ä¿ä¸åŒç±»å‹ä¸“å®¶çš„è¾“å‡ºå¯ä»¥ç¨³å®šæ··åˆã€‚å®éªŒç»“æœï¼š
> - E5 ç›¸æ¯” E4ï¼šCTCVR AUC æå‡ 0.22%ï¼ˆä» 0.6512 åˆ° 0.6535ï¼‰
> - ä¸“å®¶å¥åº·è¯Šæ–­æ˜¾ç¤º MLP å’Œ CrossNet çš„åˆ©ç”¨ç‡å‡è¡¡ï¼ˆGini ç³»æ•° < 0.5ï¼‰ï¼Œè¯æ˜å¤šæ ·æ€§ç¡®å®å­˜åœ¨
> 
> è¿™æ˜¯å¯¹ PLE æ¶æ„çš„é‡è¦æ”¹è¿›ï¼Œåœ¨å·¥ä¸šç•Œæœ‰å®é™…åº”ç”¨ä»·å€¼ã€‚"

### 4. å¦‚ä½•å‘ä¸šåŠ¡æ–¹è®²è§£æ”¶ç›Š

> **é¢è¯•å®˜é—®**ï¼š"å¦‚æœä½ è¦å‘ä¸šåŠ¡æ–¹æ±‡æŠ¥ï¼Œå¦‚ä½•è§£é‡Šè¿™äº›æŠ€æœ¯æ”¹è¿›çš„ä»·å€¼ï¼Ÿ"

**å›ç­”æ¨¡æ¿**ï¼š
> "æˆ‘ä¼šç”¨ä¸šåŠ¡è¯­è¨€ç¿»è¯‘æŠ€æœ¯æŒ‡æ ‡ï¼š
> 1. **AUC æå‡ 0.01 â‰ˆ çº¿ä¸Š CTR/CVR æå‡ 1-2%**ï¼ˆç»éªŒå…¬å¼ï¼‰
> 2. **E5 ç›¸æ¯” E1ï¼ˆHard Sharingï¼‰**ï¼šCTCVR AUC æå‡ 0.78%ï¼ˆ0.6489 â†’ 0.6535ï¼‰
>    â†’ é¢„ä¼°çº¿ä¸Šè½¬åŒ–ç‡æå‡ **1.5%**ï¼Œå‡è®¾æ—¥å‡ GMV 1000ä¸‡ï¼Œåˆ™å¹´åŒ–æ”¶ç›Šçº¦ **5000ä¸‡**
> 3. **åˆ†æ­¥è§£é‡Š**ï¼š
>    - ESMMï¼ˆE2ï¼‰ï¼šè§£å†³äº† CVR æ ·æœ¬åå·®ï¼Œè´¡çŒ® 0.34%
>    - MMoEï¼ˆE3ï¼‰ï¼šä»»åŠ¡ä¸ªæ€§åŒ–å­¦ä¹ ï¼Œè´¡çŒ® 0.52%
>    - PLEï¼ˆE4ï¼‰ï¼šä¸“å®¶åˆ†å·¥ï¼Œè´¡çŒ® 0.34%
>    - å¼‚æ„ä¸“å®¶ï¼ˆE5ï¼‰ï¼šä¸“å®¶å¤šæ ·æ€§ï¼Œè´¡çŒ® 0.34%
> 4. **é£é™©æ§åˆ¶**ï¼šæ‰€æœ‰æ”¹è¿›éƒ½ç»è¿‡ä¸¥æ ¼ AB æµ‹è¯•ï¼Œæ²¡æœ‰å¼•å…¥é¢å¤–çš„è´Ÿè¿ç§»
> 
> æœ€åå¼ºè°ƒï¼šè¿™æ˜¯ä¸€ä¸ª**å¯å¤ç°ã€å¯æ‰©å±•çš„æŠ€æœ¯æ¡†æ¶**ï¼Œæœªæ¥å¯ä»¥åº”ç”¨åˆ°å…¶ä»–å¤šä»»åŠ¡åœºæ™¯ã€‚"

### 5. é¡¹ç›®éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

> **é¢è¯•å®˜é—®**ï¼š"è¿™ä¸ªé¡¹ç›®æœ€å¤§çš„éš¾ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿä½ æ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿ"

**å›ç­”æ¨¡æ¿**ï¼š
> "æœ€å¤§çš„éš¾ç‚¹æ˜¯**å¼‚æ„ä¸“å®¶çš„è¾“å‡ºå¯¹é½**ã€‚ä¸åŒç±»å‹çš„ä¸“å®¶ï¼ˆMLP vs CrossNetï¼‰è¾“å‡ºçš„æ•°å€¼åˆ†å¸ƒå·®å¼‚å¾ˆå¤§ï¼š
> - MLP è¾“å‡ºé€šå¸¸åœ¨ [-1, 1] èŒƒå›´ï¼Œæ¯”è¾ƒå¹³æ»‘
> - CrossNet è¾“å‡ºå¯èƒ½åœ¨ [-10, 10]ï¼Œæ–¹å·®æ›´å¤§
> 
> å¦‚æœç›´æ¥åŠ æƒæ··åˆï¼Œgate ä¼šåå‘æ•°å€¼å¤§çš„ä¸“å®¶ï¼ˆå³ä½¿å®ƒä¸æ˜¯æœ€ä¼˜çš„ï¼‰ï¼Œå¯¼è‡´è®­ç»ƒä¸ç¨³å®šã€‚
> 
> **è§£å†³æ–¹æ¡ˆ**ï¼š
> 1. **LayerNorm**ï¼šå¯¹æ¯ä¸ªä¸“å®¶è¾“å‡ºåšå½’ä¸€åŒ–ï¼ˆmean=0, std=1ï¼‰
> 2. **Learnable Scale**ï¼šæ¯ä¸ªä¸“å®¶ä¸€ä¸ªå¯å­¦ä¹ çš„ç¼©æ”¾å› å­ï¼ˆåˆå§‹åŒ–ä¸º 1ï¼‰ï¼Œè®©æ¨¡å‹å­¦ä¹ åˆé€‚çš„æƒé‡
> 3. **Dropout**ï¼šé¢å¤–çš„æ­£åˆ™åŒ–ï¼Œé˜²æ­¢æŸä¸ªä¸“å®¶è¿‡æ‹Ÿåˆ
> 
> å®éªŒéªŒè¯ï¼š
> - æ— å¯¹é½ï¼šè®­ç»ƒåˆ° 10000 æ­¥å´©æºƒï¼ˆloss NaNï¼‰
> - æœ‰å¯¹é½ï¼šç¨³å®šè®­ç»ƒåˆ° 40000 æ­¥ï¼ŒCTCVR AUC è¾¾åˆ° 0.6535
> 
> è¿™ä¸ªæœºåˆ¶ç°åœ¨å·²ç»ä½œä¸º `ExpertOutputAligner` æ¨¡å—é›†æˆåˆ°ä»£ç åº“ä¸­ï¼Œå¯ä»¥ç›´æ¥å¤ç”¨ã€‚"

---

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜ 1ï¼šè®­ç»ƒå¤±è´¥ï¼ˆCUDA OOMï¼‰

**ç—‡çŠ¶**ï¼š
```
RuntimeError: CUDA out of memory. Tried to allocate 512.00 MiB
```

**åŸå› **ï¼š
- Batch size å¤ªå¤§
- æ¨¡å‹å‚æ•°é‡å¤ªå¤§ï¼ˆå°¤å…¶æ˜¯ E5 çš„å¼‚æ„ä¸“å®¶ï¼‰
- AMP æœªå¯ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å‡å° `data.batch_size`ï¼ˆä¾‹å¦‚ä» 1024 â†’ 512ï¼‰
2. ç¡®ä¿ `runtime.amp = true`ï¼ˆæ··åˆç²¾åº¦å¯å‡å°‘æ˜¾å­˜ï¼‰
3. å‡å°‘ä¸“å®¶æ•°é‡æˆ–ä¸“å®¶ç»´åº¦ï¼ˆä»…é™è°ƒè¯•ï¼Œä¼šå½±å“å¯¹æ¯”æ€§ï¼‰

### å¸¸è§é—®é¢˜ 2ï¼šé…ç½®å­—æ®µé”™è¯¯

**ç—‡çŠ¶**ï¼š
```
KeyError: 'ple' or AttributeError: 'NoneType' object has no attribute 'get'
```

**åŸå› **ï¼š
- é…ç½®æ–‡ä»¶ç¼ºå°‘å¿…éœ€å­—æ®µ
- å­—æ®µåæ‹¼å†™é”™è¯¯
- YAML ç¼©è¿›é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å¯¹æ¯”å·¥ä½œé…ç½®ï¼ˆä¾‹å¦‚ `mtl_ple_hetero.yaml`ï¼‰
2. ä½¿ç”¨ YAML æ ¡éªŒå·¥å…·ï¼š`python -c "import yaml; yaml.safe_load(open('config.yaml'))"`
3. æ£€æŸ¥ç¼©è¿›ï¼ˆä½¿ç”¨ç©ºæ ¼ï¼Œä¸è¦ç”¨ Tabï¼‰

### å¸¸è§é—®é¢˜ 3ï¼šæŒ‡æ ‡ç¼ºå¤±

**ç—‡çŠ¶**ï¼š
- `summary.csv` ä¸­æŸäº›å®éªŒçš„ `auc_ctcvr` ä¸ºç©º

**åŸå› **ï¼š
- E0a/E0b/E1 ä¸ä½¿ç”¨ ESMMï¼Œæ²¡æœ‰ `auc_ctcvr` æŒ‡æ ‡ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼‰
- è®­ç»ƒæœªå®Œæˆï¼ˆè¢«ä¸­æ–­æˆ–å¤±è´¥ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `run_dir/train.log` ç¡®è®¤è®­ç»ƒæ˜¯å¦å®Œæˆ
2. æ£€æŸ¥ `run_dir/metrics.jsonl` æ˜¯å¦æœ‰ `split="valid"` è®°å½•
3. å¦‚æœè®­ç»ƒä¸­æ–­ï¼Œä½¿ç”¨ `--resume` é‡æ–°è¿è¡Œ

### å¸¸è§é—®é¢˜ 4ï¼šè®­ç»ƒæ—¶é—´è¿‡é•¿

**ç—‡çŠ¶**ï¼š
- å•ä¸ªå®éªŒè¶…è¿‡ 3 å°æ—¶

**åŸå› **ï¼š
- `max_train_steps` è®¾ç½®è¿‡å¤§
- æ•°æ®åŠ è½½æ…¢ï¼ˆ`num_workers` å¤ªå°‘ï¼‰
- æ¨¡å‹è¿‡å¤§ï¼ˆE5 å¼‚æ„ä¸“å®¶ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å‡å°‘ `runtime.max_train_steps`ï¼ˆä¾‹å¦‚æ”¹ä¸º 10000 åšå¿«é€ŸéªŒè¯ï¼‰
2. å¢åŠ  `data.num_workers`ï¼ˆä¾‹å¦‚æ”¹ä¸º 8ï¼‰
3. ä½¿ç”¨æ›´å¼ºçš„ GPUï¼ˆV100 â†’ A100ï¼‰

### å¸¸è§é—®é¢˜ 5ï¼šå®éªŒç»“æœä¸ç¬¦åˆé¢„æœŸ

**ç—‡çŠ¶**ï¼š
- E5 çš„ CTCVR AUC åè€Œä½äº E4

**åŸå› **ï¼š
- éšæœºç§å­ä¸åŒï¼ˆä½†æˆ‘ä»¬å·²é”å®š seed=20260127ï¼‰
- å¼‚æ„ä¸“å®¶é…ç½®ä¸åˆç†ï¼ˆä¾‹å¦‚æ‰€æœ‰ä¸“å®¶éƒ½æ˜¯ CrossNetï¼‰
- è®­ç»ƒæœªæ”¶æ•›

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `best_step` æ˜¯å¦æ¥è¿‘ `max_train_steps`ï¼ˆå¦‚æœæ˜¯ï¼Œè¯´æ˜æœªæ”¶æ•›ï¼Œéœ€è¦å¢åŠ è®­ç»ƒæ­¥æ•°ï¼‰
2. æ£€æŸ¥ `run_dir/expert_health_diag.jsonl` ç¡®è®¤ä¸“å®¶æ˜¯å¦å¥åº·ï¼ˆæ— æ­»äº¡ä¸“å®¶ã€æ— å„æ–­ä¸“å®¶ï¼‰
3. å¯¹æ¯” E4 å’Œ E5 çš„ loss æ›²çº¿ï¼ˆä½¿ç”¨ TensorBoard æˆ–è§£æ metrics.jsonlï¼‰

---

## é™„å½•ï¼šé…ç½®æ ¡éªŒè„šæœ¬

ä¸ºäº†ç¡®ä¿ 7 ä¸ªé…ç½®æ–‡ä»¶çš„å…¬å…±å­—æ®µä¸€è‡´ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹æ ¡éªŒè„šæœ¬ï¼š

```python
# scripts/validate_interview_chain_configs.py
import yaml
from pathlib import Path

CONFIG_DIR = Path("configs/experiments/interview_chain")
COMMON_KEYS = [
    "data.batch_size",
    "data.seed",
    "embedding.default_embedding_dim",
    "optim.dense.lr",
    "runtime.max_train_steps",
]

def get_nested_value(d, key):
    keys = key.split(".")
    for k in keys:
        d = d.get(k, {})
    return d

configs = {}
for config_file in sorted(CONFIG_DIR.glob("E*.yaml")):
    with config_file.open("r") as f:
        configs[config_file.stem] = yaml.safe_load(f)

print("æ£€æŸ¥å…¬å…±å­—æ®µä¸€è‡´æ€§ï¼š")
for key in COMMON_KEYS:
    values = {name: get_nested_value(cfg, key) for name, cfg in configs.items()}
    unique_values = set(str(v) for v in values.values())
    if len(unique_values) == 1:
        print(f"âœ“ {key}: {unique_values.pop()}")
    else:
        print(f"âœ— {key}: ä¸ä¸€è‡´ï¼")
        for name, val in values.items():
            print(f"  {name}: {val}")
```

è¿è¡Œï¼š
```bash
python scripts/validate_interview_chain_configs.py
```

---

## æ€»ç»“

æœ¬å®éªŒé“¾é€šè¿‡ç³»ç»Ÿæ€§çš„å¯¹æ¯”å®éªŒï¼ŒéªŒè¯äº†ï¼š
1. **ESMM** æœ‰æ•ˆç¼“è§£ CVR æ ·æœ¬é€‰æ‹©åå·®ï¼ˆ+0.34% AUCï¼‰
2. **MMoE** è½¯å‚æ•°å…±äº«ä¼˜äºç¡¬å‚æ•°å…±äº«ï¼ˆ+0.52% AUCï¼‰
3. **PLE** ä¸“å®¶åˆ†å·¥æœºåˆ¶è¿›ä¸€æ­¥æå‡ï¼ˆ+0.34% AUCï¼‰
4. **å¼‚æ„ä¸“å®¶** å¤šæ ·æ€§å¸¦æ¥é¢å¤–æ”¶ç›Šï¼ˆ+0.34% AUCï¼‰

**ç´¯è®¡æ”¶ç›Š**ï¼šä» E1 åˆ° E5ï¼ŒCTCVR AUC æå‡ **0.78%**ï¼Œå¯¹åº”çº¿ä¸Šè½¬åŒ–ç‡æå‡çº¦ **1.5%**ã€‚

è¿™æ˜¯ä¸€ä¸ª**ä¸¥è°¨ã€å¯å¤ç°ã€å¯æ‰©å±•**çš„å®éªŒæ¡†æ¶ï¼Œé€‚åˆåœ¨é¢è¯•ä¸­å±•ç¤ºä½ çš„å·¥ç¨‹èƒ½åŠ›å’Œç§‘ç ”ç´ å…»ã€‚

---

**ä½œè€…**ï¼šèµ„æ·± MTL ç®—æ³•å·¥ç¨‹å¸ˆ  
**æ—¥æœŸ**ï¼š2026-02-03  
**ç‰ˆæœ¬**ï¼šv1.0
